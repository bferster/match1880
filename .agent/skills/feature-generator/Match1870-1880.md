**PHASE 1** { 

** Fellegi-Sunter common names compensation setup:**

	Create a function called buildNameFrequencies(dataset)  {
	It takes an array of person objects (the 1870 dataset). It creates and returns two Map objects (firstNameFreq and lastNameFreq). It iterates through the dataset, normalizes the first_name and last_name (lowercase, trimmed), and counts their occurrences.
	}

Create a function called getNameWeightModifier(name, freqMap) {
	It takes a normalized name and its corresponding frequency map. It returns an integer based on these rules {
	Name missing/not in map: 0
	Count <= 5 (Very Rare): +15
	Count <= 20 (Uncommon): +5
	Count between 21 and 100 (Average): 0
	Count > 100 (Common): -5
	Count > 500 (Extremely Common): -15
	}
 }
} // end of PHASE 1

**PHASE 2** {

	For each candidate pair, calculate a  weighted point score {
		Completely ignore the age field in the datasets. Use only birth_year to determine age.

		**Name match:** 

		If full_name is identical in both datasets then add +100 points.
		else if last_name is identical in both datasets and first_name is identical in both datasets {
			If there is no middle_name in both datasets then add +80 points.
			else then add +80 points.
			}
		else if last_name is identical in both datasets and norm_name is identical in both datasets then add +70 points.
		else if last_name is identical AND first_name Jaro-Winkler > 0.8 then add +60 points.
		else if last_name is Identical in both datasets and the first initial of first_name is identical in datasets then add +40 points.
		else if first_name Jaro-Winkler score is â‰¥0.85 then add +20 points. 

		**Compensate for common names**
		If the first_name is matched in the Name_match phase, call the getNameWeightModifier() function for the first_name and add it to the score.
		If the last_name is matched in the Name_match phase, call the getNameWeightModifier() function for the last_name and add it to the score.

		**Birth Year Matches:**

		if birth_year is identical in both datasets then add +50 points  
		else if birth_year +/-2 match in both datasets then add +30 points
		else if birth_year +/-5 match in both datasets then add +5 points

		**Occupation Matches:**

		if norm_occupation match in both datasets then add +10 points

		**Penalties (Red Flags):**

		gender mismatch: -200 points
		age regression (1880 birth_year < 1870 birth_year) > 5 years: -20 points
		age regression (1880 birth_year < 1870 birth_year) > 10 years: -50 points
		age gap (absolute value of (1880 birth_year - 1870 birth_year)) > 15 years: -50 points
		contradictory birth_place: -50 points
		nysiis_last_name mismatch: -100 points
		nysiis_first_name mismatch: -40 points
		race is B or M in one dataset and W in the other dataset: -50 points
		
		} // each candidate end

}  // end PHASE 2

**PHASE 3** {

	** Conflict resolution **

	If multiple 1880 records match same 1870 record: keep highest score, flag others
	If multiple 1870 records match same 1880 record: keep highest score, flag others
	One person can match at most ONE person in the other census

	} // end of PHASE 3

**PHASE 4** {

	** Household context boosting **

	1. For each match, identify their household in both censuses {

		For 1870: all records with same dwelling number
		For 1880: all records with same family number

		1. Add bonus points {
			- Head of household name match: +20 points
			- Spouse match (opposite gender, similar age): +20 points.
			- Child match (using 1880 relation field): +10 points per child, only if they are older than 10 years old.
			- Parent match: +15 points.
			- Co-residence bonus: +20 points (unless match is same as member).
			}
		2. Use 1880 relation field to validate family structure {
			- "Self" = head of household 
			- "Wife" = spouse
			- "Son" / "Daughter" = children
			- Other relations: Brother, Sister, Father, Mother, Uncle, Aunt, Nephew, Niece, etc.
			}
		don't add a co-residence bonus if the match is a same person.


	} // end of household

} // end of PHASE 4


Tier 1 is defined as having a score over 99. 
Tier 2 contains matches with scores from 80 to 99. 
Tier 3 matches have scores under 80. 
If the boosted score moves the match into a valid Tier, it is added to the results of that Tier.
